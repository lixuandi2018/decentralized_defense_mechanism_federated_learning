<!DOCTYPE html>
<!--
File Name: signup.html
File Purpose: Establish the html of the signup web page for our site
Version and Date: v3.1, 5/15/19
Authors: Jason Ngov and Vivek Khimani
Dependencies: signup.js, css, bootstrap
-->
<html>
  <head>
    <title>Flu Finder: Home</title>
    <meta charset="utf-8" />

    <!-- Bootstrap CSS files -->
    <link rel="stylesheet" type="text/css" href="home.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    />
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  </head>

  <script>
    fieldValid = false;
    passWordValid = false;
    zipCodeValid = false;

    fieldArray = [];

  /*
    * AUTH Function  by Jason Ngov
    * a) Parameters/Inputs: email, password
    * b) Output Value: Two Cases
    *      - If the credentials are valid and successful
    *          Returns to console a user-generated ID, "Account creation has been sucessful", and "Email Sent"
    *          Alerts user to "Please check your email for email verification and sign in" 
    *      - If there is an error
    *          Alerts user of errors and does not log user into Firebase authentication and database
    * c) Descriptions: 
    *      - Authenticates user and creates a profile in Firebase authentication
    *      - Loads user information (first, last, email, zipcode) into Firebase collection named 'Users', unique document ID matches with generated login ID
    * d) Preconditions:
    *      - Email and passwords must be valid. Email and password would not reach authentication function
    *        if there was a faulty email or password, and would prompt user for a better email or password 
    *        before running this auth function
    *      - If these variables are satisfied but there is a badly formatted email, or short password, Firebase error message will step in and alert the user
    * e) Postconditions:
    *      - Outputs unique userID and prompts user for email verification
  */  
    function checkPasswords() {
      password = document.getElementById("password").value;
      confirmedPassword = document.getElementById("confirmedPassword").value;
      if (password != confirmedPassword && password.length > 0) {
        document.getElementById("passwordStatus").style.color = "#FA676C";
        document.getElementById("passwordStatus").innerHTML =
          "Passwords do not match";
        passWordValid = false;
      } else if (password == confirmedPassword && password.length > 0) {
        document.getElementById("passwordStatus").style.color = "#71D79A";
        document.getElementById("passwordStatus").innerHTML =
          "Passwords match!";
        passWordValid = true;
      } else if (password == "") {
        //Special case for when password field is cleared
        document.getElementById("passwordStatus").style.color = "#FA676C";
        document.getElementById("passwordStatus").innerHTML =
          "Passwords do not match";
        passWordValid = false;
      }
    }
    /*
     * Checks each field if empty, changes fieldValid to true if all fields are filled
     * Firebase functionality in auth.js will not be called until fieldValid = true
     */
    function checkFields() {
      form = document.getElementById("signup-form");
      var i;
      for (i = 0; i < form.length - 1; i++) {
        fieldArray[i] = form[i].value;
      }
      fieldValid = fieldArray.every(isNotEmpty);
     // console.log("Fields filled: ", fieldValid);
    }
    /*
     * Returns true if string is not empty
     */
    function isNotEmpty(newStr) {
      return newStr != "";
    }

    /*
     * Checks if Zipcode field has only numbers
     *
     */
    function checkZipcode() {
      zipcode = document.getElementById("zipcode");
      if (zipcode.value.length <= 5) {
        var validInput = /[^0-9]/gi; //global, case in sensitive
        zipcode.value = zipcode.value.replace(validInput, ""); //replaces current value of zipcode with "" if input doesn't abide by validInput
        document.getElementById("zipCodeStatus").hidden = true;
        zipCodeValid = false;
        if (zipcode.value.length == 5) {
          zipCodeValid = true;
          document.getElementById("zipCodeStatus").style.color = "#71D79A";
          document.getElementById("zipCodeStatus").innerHTML =
            "Zipcode is valid!";
          document.getElementById("zipCodeStatus").hidden = false;
        }
      } else {
        zipCodeValid = false;
        zipcode.value = ""; //resets zipcode to an empty field
        document.getElementById("zipCodeStatus").hidden = false;
        document.getElementById("zipCodeStatus").style.color = "#FA676C";
        document.getElementById("zipCodeStatus").innerHTML =
          "Zipcode cannot exceed 5 characters";
      }
      //console.log(zipCodeValid);
    }
  </script>

  <body>
    <!-- Navigation Bar -->
    <!-- Navigation Bar -->

    <nav class="navbar navbar-light bg-light sticky-top">
      <a class="navbar-brand" style="font-size: 20px"
        ><img src="flu.svg" style="width: 50px; height: 50px"/> Flu Finder</a
      >
      <form class="form-inline">
        <div class="input-group" style = "padding-right: 10px">
          <input
            type="text"
            class="form-control"
            id = "login-email"
            placeholder="Email"
            aria-label="Username"
            aria-describedby="basic-addon1"
          />
        </div>
        <div class="input-group" style = "padding-right: 10px">
          <input
            type="password"
            class="form-control"
            placeholder="Password"
            aria-label="Username"
            id = "login-password"
            aria-describedby="basic-addon1"
          />
        </div>
        <button
          type="submit"
          class="btn btn-outline-success my-2 my-sm-0"
          id = "loginbtn"
        >
          Login
        </button>
      </form>
    </nav>
<!--Side jumbotron-->
<style>
#list_item{
  margin-top:40px;
}
</style>

    <div class="col-xs-12 col-sm-6 col-md-7" style="float: left">
      <!-- <div class="container"> -->
      <div class="jumbotron">
        <h4 class="display-3">Today...</h4>
        <ul>
          <h4 class="display-6">
            <li id="list_item">
              <h1 class="display-5"><b>49,000,000</b></h1>
              Americans are diagnosed with flu each year...
            </li>
            <li id="list_item">
              <h1 class="display-5"><b>960,000</b></h1>
              Americans are hospitalized because of the late flu diagnosis
              and...
            </li>
            <li id="list_item">
              <h1 class="display-5"><b>79,000</b></h1>
              Americans died because of the severe flu symptoms...
            </li>
          </h4>
        </ul>
      </div>
      <!-- -</div>- -->
    </div>

    <!-- SIGN UP FORM -->
    <div class="col-xs-12 col-sm-6 col-md-8">
      <!--
        <img src = "signup.jpg" class = "img-fluid" style = "height: 650px; border-radius: 8px;">
      -->
    </div>
    <div class="col-xs-12 col-sm-6 col-md-4" style="float: right">
      <h1 class="display-6">Sign Up!</h1>
      <div class="form-container">
        <form id="signup-form">
          <div class="form-group">
            <label><b>First</b></label>
            <input
              type="text"
              class="form-control"
              id="first"
              placeholder="First"
              required
            />
          </div>
          <div class="form-group">
            <label><b>Last</b></label>
            <input
              type="text"
              class="form-control"
              id="last"
              placeholder="Last"
              required
            />
          </div>
          <div class="form-group">
            <label><b>Email address</b></label>
            <input
              type="email"
              class="form-control"
              id="email"
              placeholder="Email"
              required
            />
          </div>
          <div class="form-group">
            <label><b>Password</b></label>
            <p style="color:#FA676C; font-size: 15px">
              Must contain at least 6 or more characters
            </p>
            <input
              type="password"
              class="form-control"
              id="password"
              placeholder="Password"
              onkeyup="checkPasswords()"
            />
          </div>
          <div class="form-group">
            <label><b>Confirm Password</b></label>
            <div style="display: inline">
              <input
                type="password"
                class="form-control"
                id="confirmedPassword"
                placeholder="Confirm Password"
                onkeyup="checkPasswords()"
                required
              />
            </div>
            <span id="passwordStatus" onkeyup="checkPasswords()"></span>
          </div>
          <div class="form-group">
            <label><b>Preferred Zipcode</b></label>
            <input
              type="text"
              class="form-control"
              id="zipcode"
              placeholder="Zipcode"
              onkeyup="checkZipcode()"
              required
            />
          </div>
          <div id="zipCodeStatus" onkeyup="checkZipcode()"></div>
          <button
            type="submit"
            class="btn btn-outline-success my-2 my-sm-0"
            id="joinbtn"
            style="margin-bottom: 25px; margin-top: 10px; float: right"
            onclick="checkFields();"
          >
            Join Now
          </button>

        </form>
      </div>
    </div>
    <!-- Boostrap and Firebase Authentication -->
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase-firestore.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyCeqaWcPXQS3PzXpmIWJ4m5Elq7Apa9sI0",
        authDomain: "flutracker-19cb9.firebaseapp.com",
        databaseURL: "https://flutracker-19cb9.firebaseio.com",
        projectId: "flutracker-19cb9"
      };
      firebase.initializeApp(config);

      //create auth reference
      const auth = firebase.auth();
      const db = firebase.firestore();
    </script>
    <script src="signup.js"></script>
  </body>
</html>
